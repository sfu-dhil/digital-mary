{"version":3,"file":"js/dist/dm.js","mappings":"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","sources":["webpack://dm/./node_modules/dhilux/js/accordion.js","webpack://dm/./node_modules/dhilux/js/lazyload.js","webpack://dm/./js/dm.js"],"sourcesContent":["/* Accordion constructor that uses the Web Animations API for fast and smooth\ntransitions. Taken from: https://css-tricks.com/how-to-animate-the-details-element-using-waapi/\nand subsequently modified by Joey Takeda.\n */\n\n\"use strict\";\n\nexport default class Accordion {\n    constructor(el) {\n        try{\n            // Store the <details> element\n            this.el = el;\n\n            // Store the <summary> element\n            this.summary = el.querySelector('summary');\n\n            // Store the <div class=\"content\"> element\n            this.content = this.makeContent();\n\n            // Store the animation object (so we can cancel it if needed)\n            this.animation = null;\n\n            //It's not doing anything at the moment.\n            this.state = [0];\n\n            // Create configuration for easing function;\n            this.easing = this.getCustomProp('easing', 'ease-in-out');\n\n            // Create an option for timing\n            this.duration = this.convertDuration(this.getCustomProp('duration', '400').trim());\n\n            // Make the heights\n            this.startHeight = null;\n            this.endHeight = null;\n\n            // Now init the actual element stuff\n            this.init();\n\n        } catch(e){\n            console.log(`${e}`);\n        }\n    }\n\n    init() {\n        // Set the aria role\n        this.el.setAttribute('aria-expanded', this.el.open);\n        // Add a class to the element\n        this.el.classList.add('accordion');\n        // Detect user clicks on the summary element\n        this.summary.addEventListener('click', (e) => this.onClick(e));\n    }\n\n    // Function to get custom properties\n    // so to align any duration/easing stuff in the CSS\n    // This can be overridden by the object declaration, however\n    getCustomProp(prop, defaultVal) {\n        //Get the actual declaration;\n        let propDecl = `--accordion-${prop}`;\n        //Get the computed style\n        let style = getComputedStyle(this.el);\n        //Get the property value\n        let propVal = style.getPropertyValue(propDecl);\n        return (propVal) ? propVal : defaultVal;\n    }\n\n    // Create the click listener\n    onClick(e) {\n        // Stop default behaviour from the browser\n        e.preventDefault();\n\n        // Add an overflow on the <details> to avoid content overflowing\n        this.el.style.overflow = 'hidden';\n\n        //Prevent any further clicking from happening\n        this.el.style.pointerEvents = 'none';\n\n        // Check if the element is being closed or is already closed\n        if (!this.el.open) {\n            this.open();\n            // Check if the element is being opened or is already open\n        } else {\n            this.close();\n        }\n    }\n\n    makeContent() {\n        let nodes = [...this.el.childNodes].filter(n => !n.isSameNode(this.summary));\n        let div = document.createElement('div');\n        div.classList.add('accordion__content');\n        nodes.forEach(node => div.appendChild(node));\n        this.el.appendChild(div);\n        return div;\n    }\n\n    open() {\n        // Apply a fixed height on the element\n        this.el.style.height = `${this.el.offsetHeight}px`;\n        // Force the [open] attribute on the details element\n        this.el.open = true;\n        // Wait for the next frame to call the expand function\n        window.requestAnimationFrame(() => this.expand());\n    }\n\n    close() {\n        //Add the aria label\n        window.requestAnimationFrame(() => this.shrink());\n    }\n\n    expand() {\n        // Set the element as \"being expanding\"\n        this.state.push(1);\n        // Get the current fixed height of the element\n        this.startHeight = `${this.el.offsetHeight}px`;\n        // Calculate the open height of the element (summary height + content height)\n        this.endHeight = `${this.summary.offsetHeight + this.content.offsetHeight}px`;\n        this.el.setAttribute('aria-expanded', 'true');\n        //Now animate\n        this.animate();\n    }\n\n    shrink() {\n        // Set the element as \"being closed\"\n        this.state.push(-1);\n        // Store the current height of the element\n        this.startHeight = `${this.el.offsetHeight}px`;\n        // Calculate the height of the summary\n        this.endHeight = `${this.summary.offsetHeight}px`;\n        this.el.setAttribute('aria-expanded', 'false');\n        this.animate();\n    }\n\n    animate() {\n        // If there is already an animation running\n        if (this.animation) {\n            // Cancel the current animation\n            this.animation.cancel();\n        }\n\n        // Start a WAAPI animation\n        this.animation = this.el.animate({\n            // Set the keyframes from the startHeight to endHeight\n            height: [this.startHeight, this.endHeight]\n        }, {\n            duration: this.duration,\n            easing: this.easing\n        });\n\n        // When the animation is complete, call onAnimationFinish()\n        this.animation.onfinish = () => this.onAnimationFinish();\n        // If the animation is cancelled, isExpanding variable is set to false\n        this.animation.oncancel = () => this.state.slice(0, 1);\n    }\n\n    onAnimationFinish() {\n        // Set the open attribute based on the parameter\n        this.el.open = this.state[1] > 0;\n        // Clear the stored animation\n        this.animation = null;\n        // Reset state\n        this.state = [0];\n        this.startHeight = this.endHeight = null;\n        // Remove the overflow hidden and the fixed height\n        this.el.style.height = this.el.style.overflow = '';\n        this.el.style.pointerEvents = 'auto';\n    }\n\n    convertDuration(dur) {\n        if (/[\\d]s$/g.test(dur)){\n            return parseFloat(dur) * 1000;\n        } else {\n            parseInt(dur, 10);\n        }\n    }\n}\n\n\n\n\n\n\n\n\n","\"use strict\"\n/*\n  * Progressive enhancement for browser-based lazy loading;\n  *\n  *\n */\nexport default class LazyLoad{\n    constructor() {\n        //Default, but can be a src.\n        this.noImg = null;\n        // Selector for the parent item to use to attach the class\n        this.parentSelector = '.item';\n        if ('loading' in HTMLImageElement.prototype){\n            try{\n                this.images = document.querySelectorAll('img[loading=\"lazy\"]');\n                this.images.forEach(img => {\n                    let item = img.closest(this.parentSelector);\n                    if (!img.complete) {\n                        item.classList.add('loading');\n                        img.addEventListener('load',  e => {\n                            item.classList.add('loaded');\n                        });\n                        img.addEventListener('error', e=> {\n                            console.log('Image ' + img.src + ' failed to load.');\n                            item.classList.add('loaded');\n                            item.classList.add('error');\n                            img.classList.add('placeholder');\n                            if (this.noImg !== null){\n                                img.src = this.noImg;\n                            }\n                        })\n                    }\n                });\n            }\n            catch(e){\n                console.log(`Error: ${e}`);\n            }\n\n        }\n    }\n}\n","/* Basic scripts for the Digital Mary Project\n */\n\nimport Accordion from 'dhilux/js/accordion.js';\nimport LazyLoad from 'dhilux/js/lazyload.js';\n/* First thing to do is set up the images for the viewer thing */\n\nlet gallery, glider\nlet imgSlider = document.querySelector('.image-slider');\nlet dmViewerContainer = document.querySelector('#dm-viewer-container');\n\ninit();\n\nfunction init(){\n    // First add the JS class\n    document.querySelector('body').classList.add('js');\n    /* Add special viewer stuff */\n    if (dmViewerContainer && imgSlider){\n        makeGlider();\n        makeImageTools();\n        makeImageViewer();\n    }\n    enhanceLazyLoad();\n    makeHamburgers();\n    makeAccordions();\n    makeAdminToggle();\n    cleanupText();\n\n}\n\nfunction makeHamburgers(){\n    document.querySelectorAll('.hamburger').forEach(ham => {\n        ham.addEventListener('click', e => {\n            ham.classList.toggle('is-active');\n        })\n    });\n}\n\nfunction makeAccordions(){\n// Now make details\n    document.querySelectorAll('details').forEach(el => {\n        let accordion = new Accordion(el);\n    });\n}\n\nfunction makeAdminToggle(){\n// Toggle for administrative stuff\n    document.querySelectorAll('.admin-toggle').forEach(el => {\n        el.addEventListener('change', e=>{\n            document.body.classList.toggle('hideAdmin');\n        });\n    });\n}\n\nfunction cleanupText(){\n// Hacks for fixing up the descriptions\n// Clean up some descriptions, but this is a hack\n    let nbspRex = /^\\s*&nbsp;\\s*$/\n    document.querySelectorAll('.item-description').forEach(div => {\n        div.querySelectorAll('p').forEach(p => {\n            let text = p.innerHTML;\n            if (nbspRex.test(text)){\n                p.parentElement.removeChild(p);\n            }\n        })\n    });\n\n}\n\nfunction makeGlider(){\n    let imgSection = document.querySelector('.images');\n    let imgCtr = imgSection.querySelector('div');\n    let slides = imgSlider.querySelectorAll('.item');\n\n    if (slides.length > 1) {\n        imgSlider.addEventListener('glider-loaded', e => {\n            imgCtr.classList.add('loaded');\n        });\n        // Set up a new glider\n        glider = new Glider(imgSlider, {\n            scrollLock: true,\n            dots: '.dots',\n            arrows: {\n                prev: '.slider-btn-prev',\n                next: '.slider-btn-next'\n            },\n            duration: 1\n        })\n\n    }\n\n\n}\n\nfunction makeImageTools(){\n    imgSlider.querySelectorAll('.img-toolbar__tools a:not([href])').forEach(link => {\n            let div = link.closest('div[id]');\n            let i = Array.from(div.parentElement.children).indexOf(div);\n            link.addEventListener('click', e => {\n                e.preventDefault();\n                if (link.classList.contains('img-tool-info')){\n                    imgSlider.querySelectorAll('details > summary').forEach(s => s.click());\n                } else if (link.classList.contains('img-tool-zoom')){\n                    gallery.view(i);\n                }\n            })\n        }\n    )\n}\n\nfunction makeImageViewer(){\n\n    const toolbarOpts = ['prev',  'zoomOut', 'zoomIn', 'reset', 'rotateLeft','rotateRight', 'next'];\n    let imgCtr = document.querySelector('.image-slider');\n    let images = imgCtr.querySelectorAll('a[data-img]');\n    let toolbar = {};\n\n    // First make the toolbar options\n    toolbarOpts.forEach(opt => {\n        let show = 1;\n        // Remove next|prev if we don't need them\n        if ((opt === 'next' || opt === 'prev') && images.length < 2){\n            show = 0;\n        }\n        toolbar[opt] = {};\n        toolbar[opt]['show'] = show;\n        toolbar[opt]['size'] = 'large';\n    });\n\n    /*  We need to figure out some way to get the gallery transitions\n        to work a bit better: we don't want the image loading in, but we\n        do want it in all other cases.\n     */\n    let currTitle;\n    gallery = new Viewer(imgCtr, {\n        url: (img) => {\n            return img.parentNode.getAttribute('data-img');\n        },\n        title: (img) => {\n            //Set the current title for easy access later\n            currTitle = img.alt;\n            return currTitle;\n        },\n        transition: true,\n        container: dmViewerContainer,\n        ready: function(e){\n            //Helpers\n            let self = gallery;\n            let title = self.title;\n            let toolbarCtr = self.toolbar.querySelector('ul');\n            let btns = toolbarCtr.querySelectorAll('li[role=\"button\"]');\n            toolbarCtr.addEventListener('mouseleave', e=>{\n                title.innerHTML = currTitle;\n            });\n            btns.forEach(btn => {\n                //Get caption\n                let pseudo = window.getComputedStyle(btn, 'before');\n                let caption = pseudo.content.replaceAll('\"','');\n                btn.addEventListener('mouseenter', e =>{\n                    title.classList.add('btn-caption')\n                    title.innerHTML = caption;\n                });\n                btn.addEventListener('mouseleave', e => {\n                    title.classList.remove('btn-caption');\n                });\n            });\n        },\n        toolbar\n    });\n\n    images.forEach( a => {\n        a.classList.add('zoomable');\n        a.addEventListener('click', e => {\n            e.preventDefault();\n        })\n    });\n}\n\n\n// Let's do some browse lazy loading...\nfunction enhanceLazyLoad(){\n    let lazy = new LazyLoad();\n    lazy.noImg = document.body.dataset.dmNoImg;\n}\n\n\n\n\n"],"names":["Accordion","constructor","el","this","summary","querySelector","content","makeContent","animation","state","easing","getCustomProp","duration","convertDuration","trim","startHeight","endHeight","init","e","console","log","setAttribute","open","classList","add","addEventListener","onClick","prop","defaultVal","propDecl","getComputedStyle","getPropertyValue","preventDefault","style","overflow","pointerEvents","close","nodes","childNodes","filter","n","isSameNode","div","document","createElement","forEach","node","appendChild","height","offsetHeight","window","requestAnimationFrame","expand","shrink","push","animate","cancel","onfinish","onAnimationFinish","oncancel","slice","dur","test","parseFloat","parseInt","LazyLoad","noImg","parentSelector","HTMLImageElement","prototype","images","querySelectorAll","img","item","closest","complete","src","gallery","glider","imgSlider","dmViewerContainer","imgCtr","length","Glider","scrollLock","dots","arrows","prev","next","makeGlider","link","i","Array","from","parentElement","children","indexOf","contains","s","click","view","currTitle","toolbar","opt","show","Viewer","url","parentNode","getAttribute","title","alt","transition","container","ready","self","toolbarCtr","btns","innerHTML","btn","caption","replaceAll","remove","a","makeImageViewer","body","dataset","dmNoImg","ham","toggle","nbspRex","p","text","removeChild","cleanupText"],"sourceRoot":""}